<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />

    <title>reveal-md</title>
    <link rel="shortcut icon" href="./favicon.ico" />
    <link rel="stylesheet" href="./dist/reset.css" />
    <link rel="stylesheet" href="./dist/reveal.css" />
    <link rel="stylesheet" href="./dist/theme/moon.css" id="theme" />
    <link rel="stylesheet" href="./css/highlight/base16/zenburn.css" />


  </head>
  <body>
    <div class="reveal">
      <div class="slides"><section  data-markdown><script type="text/template"><!-- ###################################################################### -->
## AMBA APB, AHB and AXI
<!-- .slide: data-background="#145A32" -->
<!-- ###################################################################### -->

[rodrigomelo9.github.io/amba](https://rodrigomelo9.github.io/amba)

Rodrigo Alejandro Melo

[Creative Commons Attribution 4.0 International](https://creativecommons.org/licenses/by/4.0/)
</script></section><section ><section data-markdown><script type="text/template"><!-- ###################################################################### -->
### Advanced Microcontroller Bus Architecture
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->

AMBA is a freely available, globally adopted, open standard for the connection and management of functional blocks in a System-on-Chip (SoC).
It facilitates right-first-time development of multiprocessor designs, with large numbers of controllers and peripherals.
</script></section><section data-markdown><script type="text/template">
### AMBA Specs

|                                     | AMBA          | AMBA2          | AMBA3              | AMBA4                       | AMBA5
| :---:                               | :---:         | :---:          | :---:              | :---:                       | :---:
|                                     |               |                |                    | AXI4-Stream<br>(2010)       | AXI5-Stream<br>(2021)
| Advanced<br>eXtensible<br>Interface |               |                | AXI3<br>(2003/4)   | AXI4<br>AXI4-Lite<br>(2010) | AXI5<br>AXI5-Lite<br>(2017/21)
| Advanced<br>High-performance<br>Bus |               | AHB<br>(1999)  | AHB-Lite<br>(2006) |                             | AHB5<br>AHB5-Lite<br>(2015/21)
| Advanced<br>System<br>Bus           | ASB<br>(1996) | ASB<br>(1996)  |                    |                             |
| Advanced<br>Peripherals<br>Bus      | APB<br>(1996) | APB2<br>(1999) | APB3<br>(2003/4)   | APB4<br>(2010)              | APB5<br>(2021)
<!-- .element: style="font-size: 0.5em !important;" -->

> **WARNING:** ASB and the first APB are deprecated (shouldn't be used in new designs)
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### Terminology

Term        | Description
---         |---
Interface   | APB, AHB, AXI (a core could have multiple)
Channel     | Independent collection of AXI signals associated to a VALID
Bus         | Multi-bit signal (not an interface, not a channel)
Transfer    | (aka beat) single clock cycle, qualified by a VALID/READY handshake
Transaction | Complete communication, with one or more transfers
Burst       | Transaction with more than one transfer
Manager     | Agent that initiates transactions
Subordinate | Agent that receives and responds to requests
<!-- .element: style="font-size: 0.5em !important;" -->
</script></section><section data-markdown><script type="text/template">
### General considerations

* All signals are sampled at the rising edge of xCLK.
* xRESETn is the only active low signal.
* xADDR indicates a byte address.
* Read and write data buses must have the same width.
</script></section></section><section ><section data-markdown><script type="text/template">
<!-- ###################################################################### -->
### APB - Advanced Peripherals Bus
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->

A low-cost interface, optimized for minimal power consumption and reduced complexity.
It is not  pipelined and is a simple, synchronous protocol.
Every transfer takes at least two cycles to complete.

Main uses:
* Low bandwidth peripherals
* Control/Status registers

> Transfers are typically initiated by a bridge (Requester), and a peripheral interface (Completer) responds.
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### APB signals

|                | APB2  | APB3  | APB4  | APB5  | Default | Description
| ---            | :---: | :---: | :---: | :---: | :---:   | ---
| PCLK           | Y     | Y     | Y     | Y     |         | Clock
| PRESETn        | Y     | Y     | Y     | Y     |         | Reset
| PADDR[A-1:0]   | Y     | Y     | Y     | Y     |         | Address (up to 32 bits)
| PSELx          | Y     | Y     | Y     | Y     |         | Completer x selected
| PENABLE        | Y     | Y     | Y     | Y     |         | Enable
| PWRITE         | Y     | Y     | Y     | Y     |         | Write operation
| PWDATA[D-1]    | Y     | Y     | Y     | Y     |         | Write Data. (8, 16 or 32 bits)
| PRDATA[D-1]    | Y     | Y     | Y     | Y     |         | Read Data (8, 16 or 32 bits)
| PREADY         |       | O     | O     | O     | 1'b1    | Indicates the completion of a transfer
| PSLVERR        |       | O     | O     | O     | 1'b0    | Indicates an error condition
| PPROT[2:0]     |       |       | O     | O     | '0      | Normal, privileged, or secure protection level
| PSTRB[D/8-1:0] |       |       | O     | O     | '1      | Write Strobe (bytes to update during a write)
| PWAKEUP        |       |       |       | O     |         | Wake-up
| PxUSER[]       |       |       |       | O     |         | User defined attribute
| PxCHK          |       |       |       | O     |         | Parity protection (for safety-critical applications)
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### APB4-S interface

![APB-S interface](images/apb-s.svg)
</script></section><section data-markdown><script type="text/template">
### APB4 Signaling

![APB Signaling](images/apb-waves.png)
</script></section><section data-markdown><script type="text/template">
### APB3 - PREADY

* Completer can use PREADY to extend (introduce wait states) transfers.
* Peripherals with fixed two-cycle access can set PREADY always HIGH.
</script></section><section data-markdown><script type="text/template">
### APB3 - PSLVERR

* Can be used to indicate an ERROR condition (error, unsupported, timeout, etc).
* A WRITE transaction with ERROR, might or might not have updated the state of the peripheral.
* A READ transaction with ERROR, might or might not provide valid data.
</script></section><section data-markdown><script type="text/template">
### APB4 - PSTRB

* Enables sparse data transfer on the write data bus
* There is one bit per each byte of PWDATA
  * PSTRB[n] -> PWDATA[(8n + 7):(8n)]
* When asserted HIGH, the corresponding byte of PWDATA contains valid information

> **ATTENTION:** during read transfers, all the bits of PSTRB **must** be driven LOW
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### APB4 - PPROT

* PPROT[0]: Normal or Privileged
* PPROT[1]: Secure or Non-secure
* PPROT[2]: Data or Instruction

> **ATTENTION:** the primary use of PPROT is as an identifier for Secure or Non-secure transactions (it is acceptable to use different interpretations for PPROT[0] and PPROT[2])
<!-- .element: style="font-size: 0.4em !important;" -->

> **WARNING:** PPROT[2] is provided as a hint, but might not be accurate in all cases
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### APB design considerations - Unaligned transfers
<!-- .slide: data-background="yellow" -->

PADDR can be unaligned, but the result is UNPREDICTABLE (Completer may utilize the unaligned address, aligned address, or indicate an error response).
</script></section><section data-markdown><script type="text/template">
### APB design considerations - Operating States
<!-- .slide: data-background="yellow" -->

![APB states](images/apb-states.svg)

> When a transfer is required, the interface moves into the SETUP state, where the appropriate PSELx is asserted.
> The interface remains in this state for one clock cycle and always moves to the ACCESS state, where PENABLE is asserted.
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### APB design considerations - Validity rules
<!-- .slide: data-background="yellow" -->

* PSEL must be always valid
* PADDR, PPROT, PENABLE, PWRITE, PSTRB and PWDATA must be valid when PSEL is asserted
* PREADY must be valid when PSEL, and PENABLE are asserted
* PRDATA, and PSLVERR must be valid when PSEL, PENABLE and PREADY are asserted

> **RECOMMENDATION:** signals which are not required to be valid should be driven to zero
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section></section><section ><section data-markdown><script type="text/template">
<!-- ###################################################################### -->
### AHB - Advanced High-performance Bus
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->

Main uses:
* High Performance system bus
* Lite: single masters
</script></section><section data-markdown><script type="text/template">
### AHB signals

|               | AHB2     | AHB-Lite  | AHB5    | Default | Description
| ---           | :---:    | :---:     | :---:   | :---:   | ---
| HCLK          | Y        | Y         | Y       |         | Clock
| HRESETn       | Y        | Y         | Y       |         | Reset
| HADDR[]       | Y        | Y         | Y       |         | Address (32-bits, between 10 and 64 in AHB5)
| HSELx         | Y        | Y         | Y       |         | Selected (combinatorial decode of the address bus)
| HTRANS[1:0]   | Y        | Y         | Y       |         | Transfer type (IDLE, BUSY, NONSEQ, SEQ)
| HWRITE        | Y        | Y         | Y       |         | Write operation
| HSIZE[2:0]    | Y        | Y         | Y       |         | Size of the transfer (2^SIZE bytes)
| HBURST[2:0]   | O        | O         | O       | 2'b01   | Burst length and address increments
| HPROT[]       | O [3:0]  | O [3:0]   | O [2:0] | 3'b010  | Normal, privileged, or secure protection level
| HWDATA[]      | Y [31:0] | Y [31:0]  | Y       |         | WR (8, 16, 32, 64, 128, 256, 512, 1024 bits)
| HRDATA[]      | Y [31:0] | Y [31:0]  | Y       |         | RD (8, 16, 32, 64, 128, 256, 512, 1024 bits)
| HWSTRB[D/8-1] |          | O (AMBA5) | O       | '1      | Write Strobe (bytes to update during a write)
| HREADY        | Y        | Y         | Y       |         | (IN) other transfers completed
| HRESP         | Y [1:0]  | Y         | Y       |         | Transfer response
| HBUSREQx      | Y        |           |         |         | Bus required
| HLOCKx        | Y        |           |         |         | Locked access required
| HGRANTx       | Y        |           |         |         | Locked access has the highest priority
| HMASTER[]     | O [3:0]  |           | O [7:0] | '0      | Manager identifier
| HMASTLOCK     | O        | O         | O       | 1'b0    | Current transfer is part of a locked sequence
| HSPLITx[15:0] | Y        |           |         |         | M to re-attempt a split transaction
| HREADYOUT     |          | Y         | Y       |         | (OUT) transfer has finished
| HNONSEC       |          |           | O       | 0'b0    | Indicates Non-secure transaction
| HEXCL         |          |           | O       | 0'b0    | Exclusive Access
| HEXOKAY       |          |           | O       | 0'b0    | Exclusive Okay
| HxUSER[]      |          |           | O       |         | User defined attribute
| HxCHKx        |          |           | O       |         | Parity protection (for safety-critical applications)
<!-- .element: style="font-size: 0.3em !important;" -->
</script></section><section data-markdown><script type="text/template">
### AHB-Lite interfaces

![AHB interface](images/ahb.svg)
</script></section><section data-markdown><script type="text/template">
### AHB-Lite Signaling (basic transfers)

![AHB basic transfers signaling](images/ahb-waves-basic.png)
</script></section><section data-markdown><script type="text/template">
### AHB-Lite Signaling (multiple transfers)

![AHB multiple transfers signaling](images/ahb-waves-multi.png)

> Extending the data phase of transfer B has the effect of extending the address phase of transfer C.
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### AHB - HREADY & HREADYOUT
</script></section><section data-markdown><script type="text/template">
### AHB - HRESP (transfer response)
</script></section><section data-markdown><script type="text/template">
### AHB5 - HWSTRB

* Enables sparse data transfer on the write data bus
* There is one bit per each byte of HWDATA
  * HWSTRB[n] -> HWDATA[(8n + 7):(8n)]
* When asserted HIGH, the corresponding byte of HWDATA contains valid information

> * During read transfers, it is recommended that write strobes are deasserted.
> * Write transfers with all HWSTRB deasserted are permitted (no bytes are written).
> * HWSTRB can change between beats of a burst.
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### AHB - HPROT (protection control)
</script></section><section data-markdown><script type="text/template">
### AHB - HTRANS (transfer types)
</script></section><section data-markdown><script type="text/template">
### AHB - HSIZE (transfer size)
</script></section><section data-markdown><script type="text/template">
### AHB - HBURST (burst types)
</script></section><section data-markdown><script type="text/template">
### AHB - Burst operation
</script></section><section data-markdown><script type="text/template">
### AHB - HMASTLOCK (locked transfers)
</script></section><section data-markdown><script type="text/template">
### AHB design considerations - TBD
<!-- .slide: data-background="yellow" -->
</script></section></section><section ><section data-markdown><script type="text/template"><!-- ###################################################################### -->
### AXI - Advanced eXtensible Interface
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->

Main uses:
* Full: Higher performance system bus
* Lite: Control/Status registers
* Stream: High speeds unidirectional transfers
</script></section><section data-markdown><script type="text/template">
### AXI signals

Write Address Channel    | Write Data Channel         | Read Address Channel     | Read Data Channel
---                      |---                         |---                       |---
AWID[]                   | ~~WID[]~~                  | ARID[]                   | RID[]
AWADDR[]                 | WDATA[]                    | ARADDR[]                 | RDATA[]
AWLEN[7:0] -- __MOD__    | WSTRB[]                    | ARLEN[7:0] -- __MOD__    | RRESP[1:0]
AWSIZE[2:0]              | WLAST                      | ARSIZE[2:0]              | RLAST
AWBURST[1:0]             | WUSER[] -- __NEW__         | ARBURST[1:0]             | RUSER[] -- __NEW__
AWLOCK -- __MOD__        | WVALID                     | ARLOCK -- __MOD__        | RVALID
AWCACHE[3:0]             | WREADY                     | ARCACHE[3:0]             | RREADY
AWPROT[2:0]              | __Write Response Channel__ | ARPROT[2:0]              |
AWQOS[3:0] -- __NEW__    | BID[]                      | ARQOS[3:0] -- __NEW__    |
AWREGION[3:0] -- __NEW__ | BRESP[1:0]                 | ARREGION[3:0] -- __NEW__ |
AWUSER[] -- __NEW__      | BUSER[] -- __NEW__         | ARUSER[] -- __NEW__      | __Global signals__
AWVALID                  | BVALID                     | AWVALID                  | ACLK
AWREADY                  | BREADY                     | AWREADY                  | ARESETn
<!-- .element: style="font-size: 0.5em !important;" -->

> * AXI3: AxLEN[3:0] and AxLOCK[1:0].
> * AXI4: removed WID, added AxQOS, AxREGION and xUSER.
> * AXI5: several signals added (not only parity)
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### AXI signals description

Signal   | Description
---      |---
AxPROT   | Protection type (un/privileged, non/secure, data/instruction access)
WSTRB    | Write strobe, indicates valid bytes
xRESP    | OKAY, EXOKAY (exclusive), SLVERR (Slave ERROR), DECERR (Decode ERROR)
AxLEN    | Burst length (AxLEN + 1)
AxSIZE   | 1, 2, 4, 8, 16, 32, 64, 128 bytes of the beat (2^AxSIZE)
AxBURST  | FIXED, INCR, WRAP, reserved
xLAST    | Indicates last beat in the burst
AxLOCK   | Normal, exclusive or locked (only AXI3) access
AxCACHE  | Indicates Bufferable, Cacheable, and Allocate attributes
AxQOS    | Quality of Service
AxREGION | Up to 16 regions for the address decode
xID      | Transaction identifiers (ordering)
xUSER    | User-defined (not recommended)
<!-- .element: style="font-size: 0.5em !important;" -->
</script></section><section data-markdown><script type="text/template">
### AXI4 interface

![AXI4 interface](images/axi.svg)
</script></section><section data-markdown><script type="text/template"><!-- ###################################################################### -->
### AXI-Lite signals
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->

|Write Address Channel | Write Data Channel         | Read Address Channel     | Read Data Channel
|---                   |---                         |---                       |---
|AWADDR[]              | WDATA[]                    | ARADDR[]                 | RDATA[]
|AWPROT[2:0]           | WSTRB[]                    | ARPROT[2:0]              | RRESP[1:0]
|AWVALID               | WVALID                     | AWVALID                  | RVALID
|AWREADY               | WREADY                     | AWREADY                  | RREADY
|                      | __Write Response Channel__ |                          |
|                      | BRESP[1:0]                 |                          | __Global signals__
|                      | BVALID                     |                          | ACLK
|                      | BREADY                     |                          | ARESETn
<!-- .element: style="font-size: 0.5em !important;" -->

> AXI5-lite: several signals added, for parity and more flexibility on bus width and ordering
<!-- .element: style="font-size: 0.4em !important;" -->
</script></section><section data-markdown><script type="text/template">
### AXI4-Lite interface

![AXI4-Lite interface](images/axi-lite.svg)
</script></section><section data-markdown><script type="text/template"><!-- ###################################################################### -->
### AXI-Stream signals
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->

| AXI4-Stream  | AXI5-Stream  | Description
|---           |--            |---
| ACLK         | ACLK         | Clock
| ARESETn      | ARESETn      | Reset
| TVALID       | TVALID       | Valid
| TREADY       | TREADY       | Ready
| TDATA[D-1:0] | TDATA[D-1:0] | D: 8, 16, 32, 64, 128, 256, 512, 1024 (bits)
| TSTRB[]      | TSTRB[]      | Indicates is the associated byte is a data byte or a position byte
| TKEEP[]      | TKEEP[]      | Indicates which bytes must be transported to the destination
| TLAST        | TLAST        | Indicates the boundary of a packet
| TID[]        | TID[]        | Data stream identifier
| TDEST[]      | TDEST[]      | Provides routing information
| TUSER[]      | TUSER[]      | User-defined sideband information
|              | TWAKEUP      | Wake-up
|              | T*CHK        | Parity (for safety)
<!-- .element: style="font-size: 0.5em !important;" -->
</script></section></section><section ><section data-markdown><script type="text/template"><!-- ###################################################################### -->
### Interconnect
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->
</script></section><section data-markdown><script type="text/template">
### Buses
</script></section><section data-markdown><script type="text/template">
### Crossbar switches
</script></section><section data-markdown><script type="text/template">
### Network-on-Chip (NoC)
</script></section></section><section  data-markdown><script type="text/template"><!-- ###################################################################### -->
### AMBA5 parity signals
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->

<!-- diagram about interconnect protection -->
</script></section><section ><section data-markdown><script type="text/template"><!-- ###################################################################### -->
### Last considerations
<!-- .slide: data-background="#581845" -->
<!-- ###################################################################### -->
</script></section><section data-markdown><script type="text/template">
### Multiple interfaces per device

![DMA example](images/dma-example.svg)
</script></section></section><section  data-markdown><script type="text/template"><!-- ###################################################################### -->
# Questions?
<!-- .slide: data-background="#1F618D" -->
<!-- ###################################################################### -->

|   |   |
|---|---|
| ![GitHub icon](icons/github.png)     | [rodrigomelo9](https://github.com/rodrigomelo9)                          |
| ![Twitter icon](icons/twitter.png)   | [rodrigomelo9ok](https://twitter.com/rodrigomelo9ok)                     |
| ![LinkedIn icon](icons/linkedin.png) | [rodrigoalejandromelo](https://www.linkedin.com/in/rodrigoalejandromelo) |
|   |   |
</script></section></div>
    </div>

    <script src="./dist/reveal.js"></script>

    <script src="./plugin/markdown/markdown.js"></script>
    <script src="./plugin/highlight/highlight.js"></script>
    <script src="./plugin/zoom/zoom.js"></script>
    <script src="./plugin/notes/notes.js"></script>
    <script src="./plugin/math/math.js"></script>
    <script>
      function extend() {
        var target = {};
        for (var i = 0; i < arguments.length; i++) {
          var source = arguments[i];
          for (var key in source) {
            if (source.hasOwnProperty(key)) {
              target[key] = source[key];
            }
          }
        }
        return target;
      }

      // default options to init reveal.js
      var defaultOptions = {
        controls: true,
        progress: true,
        history: true,
        center: true,
        transition: 'default', // none/fade/slide/convex/concave/zoom
        slideNumber: true,
        plugins: [
          RevealMarkdown,
          RevealHighlight,
          RevealZoom,
          RevealNotes,
          RevealMath
        ]
      };

      // options from URL query string
      var queryOptions = Reveal().getQueryHash() || {};

      var options = extend(defaultOptions, {}, queryOptions);
    </script>


    <script>
      Reveal.initialize(options);
    </script>
  </body>
</html>
